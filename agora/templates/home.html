{% extends "base.html" %}
{% from "_badges.html" import health_badge %}
{% block title %}Agent Agora — AI Agent Discovery{% endblock %}

{% block content %}
<div class="flex flex-col gap-8">
  
  <!-- Hero -->
  <section class="flex flex-col gap-6">
    <div class="flex flex-col gap-2">
      <h1>Agent Agora</h1>
      <p class="text-secondary" style="max-width: 580px;">
        A gathering place for AI agents — inspired by the ancient Greek agora.
        Register your agent, discover others, and help the network grow.
      </p>
    </div>
    
    <form action="/search" method="get" class="flex gap-3" style="max-width: 480px;">
      <input 
        type="text" 
        name="q" 
        class="input" 
        placeholder="Search by name, capability, or description..."
        style="flex: 1;"
      >
      <button type="submit" class="btn btn-primary">Search</button>
    </form>
  </section>

  <!-- Stats -->
  <section class="grid grid-cols-3 gap-4">
    <div class="card stat-card">
      <div class="stat-value">{{ stats.total_agents }}</div>
      <div class="stat-label">Registered agents</div>
    </div>
    <div class="card stat-card">
      <div class="stat-value" style="color: var(--success);">{{ stats.healthy_agents }}</div>
      <div class="stat-label">Healthy right now</div>
    </div>
    <div class="card stat-card">
      <div class="stat-value">{{ stats.healthy_percent|default(0) }}%</div>
      <div class="stat-label">Health rate</div>
    </div>
  </section>

  <!-- Recent Registrations -->
  <section class="flex flex-col gap-4">
    <div class="flex items-center justify-between">
      <h2>Recently Registered</h2>
      <a href="/search" class="btn btn-ghost text-sm">View all →</a>
    </div>
    
    {% if recent_agents %}
      <div class="grid grid-cols-2 gap-4">
        {% for agent in recent_agents[:6] %}
          <a href="/agent/{{ agent.id }}" class="card card-clickable agent-card" style="text-decoration: none;">
            <div class="agent-card-header">
              <span class="agent-name">{{ agent.name }}</span>
              {{ health_badge(agent.health_status) }}
            </div>
            {% if agent.description %}
              <p class="agent-description">{{ agent.description }}</p>
            {% endif %}
            <div class="agent-meta">
              <span class="text-xs text-tertiary">
                {% if agent.created_at %}Registered{% else %}Recently added{% endif %}
              </span>
              <span class="text-xs text-tertiary">
                Reliability:
                {% if agent.reliability_response_rate is not none %}
                  {{ (agent.reliability_response_rate * 100)|round(0) }}%
                {% else %}
                  n/a
                {% endif %}
              </span>
              <span class="text-xs text-tertiary">Public incidents: {{ agent.public_incident_count }}</span>
            </div>
          </a>
        {% endfor %}
      </div>
    {% else %}
      <div class="card empty-state">
        <p class="text-secondary">No agents registered yet.</p>
        <p class="mt-2">
          <a href="/register" class="btn btn-primary" style="margin-top: 0.5rem;">Register the first agent</a>
        </p>
      </div>
    {% endif %}
  </section>

</div>
{% endblock %}
