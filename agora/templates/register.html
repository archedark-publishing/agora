{% extends "base.html" %}
{% block title %}Register Agent - Agora{% endblock %}

{% block head %}
<style>
  .handoff-container {
    max-width: 860px;
    margin: 0 auto;
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }
  .hero {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }
  .hero p {
    color: var(--ink-secondary);
    max-width: 70ch;
  }
  .prompt-box {
    min-height: 360px;
    resize: vertical;
    font-size: 0.875rem;
    line-height: 1.5;
  }
  .button-row {
    display: flex;
    flex-wrap: wrap;
    gap: 0.625rem;
    margin-top: 0.75rem;
  }
  .status-message {
    margin-top: 0.625rem;
    font-size: 0.875rem;
    color: var(--ink-secondary);
    min-height: 1.25rem;
  }
  .registry-details {
    display: flex;
    flex-direction: column;
    gap: 0.625rem;
  }
  .registry-item {
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    background: var(--bg);
    padding: 0.625rem 0.75rem;
    font-size: 0.875rem;
  }
  .registry-item code {
    display: block;
    margin-top: 0.375rem;
    font-size: 0.8125rem;
    word-break: break-all;
  }
</style>
{% endblock %}

{% block content %}
<div class="handoff-container">
  <section class="card hero">
    <h1>Give this to your Agent and it will handle the rest.</h1>
    <p>
      No manual registration form is needed. Copy the message below and paste it into your coding
      agent. Your agent should discover its own details, create/store its own owner API key, and
      register itself directly.
    </p>
  </section>

  <section class="card">
    <h2>Message for Your Agent</h2>
    <p class="text-secondary text-sm" style="margin-top: 0.375rem;">
      Copy this exactly and send it to your agent.
    </p>
    <textarea id="agent_handoff_prompt" class="input mono prompt-box" readonly>{{ handoff_prompt }}</textarea>
    <div class="button-row">
      <button type="button" id="copy-prompt-btn" class="btn btn-primary">Copy message</button>
      <a href="/search" class="btn btn-secondary">Explore registry</a>
    </div>
    <div id="copy-status" class="status-message"></div>
  </section>

  <section class="card registry-details">
    <h3>Registry Context</h3>
    <div class="registry-item">
      Base URL
      <code>{{ registry_base_url }}</code>
    </div>
    <div class="registry-item">
      Health endpoint
      <code>{{ health_endpoint }}</code>
    </div>
    <div class="registry-item">
      Register endpoint
      <code>{{ register_endpoint }}</code>
    </div>
    <div class="registry-item">
      Auth header
      <code>X-API-Key: &lt;owner-api-key&gt;</code>
    </div>
  </section>
</div>

<script>
async function copyPrompt() {
  const status = document.getElementById("copy-status");
  const prompt = document.getElementById("agent_handoff_prompt").value || "";
  if (!prompt) {
    status.textContent = "Nothing to copy.";
    return;
  }
  try {
    await navigator.clipboard.writeText(prompt);
    const button = document.getElementById("copy-prompt-btn");
    const previous = button.textContent;
    button.textContent = "Copied";
    status.textContent = "Message copied. Paste it into your agent.";
    setTimeout(() => {
      button.textContent = previous;
    }, 1300);
  } catch (_error) {
    status.textContent = "Clipboard unavailable. Copy the message manually.";
  }
}

document.getElementById("copy-prompt-btn").addEventListener("click", copyPrompt);
</script>
{% endblock %}
