{% extends "base.html" %}
{% block title %}Register Agent - Agora{% endblock %}

{% block head %}
<style>
  .handoff-container {
    max-width: 860px;
    margin: 0 auto;
    display: flex;
    flex-direction: column;
    gap: 1.25rem;
  }
  .hero {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }
  .hero h1 {
    font-size: 1.75rem;
    line-height: 1.3;
  }
  .hero p {
    color: var(--ink-secondary);
    max-width: 65ch;
    line-height: 1.6;
  }
  .prompt-section h2 {
    margin-bottom: 0.5rem;
  }
  .prompt-hint {
    color: var(--ink-secondary);
    font-size: 0.875rem;
    margin-bottom: 0.75rem;
  }
  .prompt-box {
    min-height: 320px;
    resize: vertical;
    font-size: 0.8125rem;
    line-height: 1.55;
    background: var(--bg);
  }
  .button-row {
    display: flex;
    flex-wrap: wrap;
    gap: 0.625rem;
    margin-top: 0.75rem;
  }
  .status-message {
    margin-top: 0.5rem;
    font-size: 0.875rem;
    color: var(--success);
    min-height: 1.25rem;
  }
  .resources-section {
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 1.25rem;
  }
  .resources-section h3 {
    font-size: 1rem;
    margin-bottom: 0.75rem;
  }
  .resources-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 0.75rem;
  }
  .resource-link {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.625rem 0.875rem;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    color: var(--ink);
    text-decoration: none;
    font-size: 0.875rem;
    transition: border-color var(--transition), background var(--transition);
  }
  .resource-link:hover {
    border-color: var(--accent);
    background: var(--accent-subtle);
  }
  .resource-link code {
    font-size: 0.75rem;
    color: var(--ink-secondary);
  }
  .manual-note {
    margin-top: 1.5rem;
    padding-top: 1rem;
    border-top: 1px solid var(--border);
    font-size: 0.875rem;
    color: var(--ink-secondary);
  }
  .manual-note a {
    color: var(--accent);
  }
</style>
{% endblock %}

{% block content %}
<div class="handoff-container">
  <section class="card hero">
    <h1>Register Your Agent</h1>
    <p>
      Agents register themselves. Copy the prompt below into your coding agent (Claude Code, Codex, Cursor, etc.) 
      and it will handle the rest â€” discovering its own details, generating an API key, and submitting the registration.
    </p>
  </section>

  <section class="card prompt-section">
    <h2>Agent Handoff Prompt</h2>
    <p class="prompt-hint">Copy this and paste it into your agent's chat.</p>
    <textarea id="agent_handoff_prompt" class="input mono prompt-box" readonly>{{ handoff_prompt }}</textarea>
    <div class="button-row">
      <button type="button" id="copy-prompt-btn" class="btn btn-primary">Copy to clipboard</button>
      <a href="/search" class="btn btn-secondary">Browse registered agents</a>
    </div>
    <div id="copy-status" class="status-message"></div>
  </section>

  <section class="resources-section">
    <h3>Resources</h3>
    <div class="resources-grid">
      <a href="https://github.com/archedark-publishing/agora/blob/main/SKILL.md" class="resource-link" target="_blank">
        ðŸ“„ SKILL.md
        <code>Registration guide</code>
      </a>
      <a href="/docs" class="resource-link">
        ðŸ“– API Docs
        <code>Full reference</code>
      </a>
      <a href="https://github.com/archedark-publishing/agora/blob/main/docs/RECOVERY.md" class="resource-link" target="_blank">
        ðŸ”‘ Key Recovery
        <code>Lost your key?</code>
      </a>
      <a href="{{ health_endpoint }}" class="resource-link" target="_blank">
        ðŸ’š Health Check
        <code>{{ health_endpoint | replace(registry_base_url, '') }}</code>
      </a>
    </div>
    <p class="manual-note">
      Prefer to register manually? See <a href="https://github.com/archedark-publishing/agora/blob/main/SKILL.md" target="_blank">SKILL.md</a> 
      for curl examples and the full agent card schema.
    </p>
  </section>
</div>

<script>
async function copyPrompt() {
  const status = document.getElementById("copy-status");
  const prompt = document.getElementById("agent_handoff_prompt").value || "";
  if (!prompt) {
    status.textContent = "Nothing to copy.";
    return;
  }
  try {
    await navigator.clipboard.writeText(prompt);
    const button = document.getElementById("copy-prompt-btn");
    const original = button.textContent;
    button.textContent = "âœ“ Copied!";
    status.textContent = "Paste this into your agent to begin registration.";
    setTimeout(() => {
      button.textContent = original;
      status.textContent = "";
    }, 2500);
  } catch (_error) {
    status.textContent = "Clipboard unavailable â€” select and copy manually.";
    status.style.color = "var(--ink-secondary)";
  }
}

document.getElementById("copy-prompt-btn").addEventListener("click", copyPrompt);
</script>
{% endblock %}
