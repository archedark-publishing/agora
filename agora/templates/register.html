{% extends "base.html" %}
{% block title %}Register Agent — Agora{% endblock %}

{% block head %}
<style>
  .register-container {
    max-width: 560px;
    margin: 0 auto;
  }
  .form-section {
    display: flex;
    flex-direction: column;
    gap: 1.25rem;
  }
  .form-group {
    display: flex;
    flex-direction: column;
    gap: 0.375rem;
  }
  .form-hint {
    font-size: 0.8125rem;
    color: var(--ink-tertiary);
  }
  .success-card {
    text-align: center;
    padding: 2rem;
  }
  .success-icon {
    width: 64px;
    height: 64px;
    background: var(--success-subtle);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 1rem;
  }
  .key-display {
    background: #1e1e1e;
    color: #4ade80;
    padding: 1rem;
    border-radius: var(--radius-sm);
    font-family: "JetBrains Mono", monospace;
    font-size: 0.875rem;
    margin: 1rem 0;
    word-break: break-all;
    position: relative;
  }
  .key-warning {
    background: var(--warning-subtle);
    border: 1px solid var(--warning);
    border-radius: var(--radius-sm);
    padding: 0.75rem 1rem;
    color: var(--warning);
    font-size: 0.875rem;
    display: flex;
    align-items: flex-start;
    gap: 0.5rem;
  }
  .error-message {
    background: var(--danger-subtle);
    border: 1px solid var(--danger);
    border-radius: var(--radius-sm);
    padding: 0.75rem 1rem;
    color: var(--danger);
    font-size: 0.875rem;
  }
  .textarea {
    min-height: 100px;
    resize: vertical;
  }
</style>
{% endblock %}

{% block content %}
<div class="register-container flex flex-col gap-6">

  {% if success %}
    <!-- Success state -->
    <div class="card success-card">
      <div class="success-icon">
        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="var(--success)" stroke-width="2">
          <path d="M20 6L9 17l-5-5"/>
        </svg>
      </div>
      <h1 style="font-size: 1.5rem;">{{ agent_name }} is live!</h1>
      <p class="text-secondary mt-2">Your agent is now discoverable in the registry.</p>
      
      <div class="key-warning mt-6">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="flex-shrink: 0;">
          <path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/>
          <line x1="12" y1="9" x2="12" y2="13"/>
          <line x1="12" y1="17" x2="12.01" y2="17"/>
        </svg>
        <span>Save your API key now. You won't be able to see it again.</span>
      </div>
      
      <div class="key-display">
        <span id="api-key">{{ api_key }}</span>
      </div>
      
      <button class="btn btn-primary" onclick="copyKey()" id="copy-btn" style="width: 100%;">
        Copy API Key
      </button>
      
      <div class="flex gap-3 mt-6 justify-center">
        <a href="/agent/{{ agent_id }}" class="btn btn-secondary">View agent profile</a>
        <a href="/register" class="btn btn-ghost">Register another</a>
      </div>
    </div>

  {% else %}
    <!-- Registration form -->
    <div class="flex flex-col gap-2">
      <h1>Register an Agent</h1>
      <p class="text-secondary">
        Add your A2A-compatible agent to the public registry. You'll receive an API key for future updates.
      </p>
    </div>

    {% if error %}
      <div class="error-message">{{ error }}</div>
    {% endif %}

    <form action="/register" method="post" class="card form-section">
      
      <div class="form-group">
        <label class="label" for="name">Agent name</label>
        <input 
          type="text" 
          id="name" 
          name="name" 
          class="input" 
          placeholder="My Agent"
          value="{{ form.name|default('') }}"
          required
        >
      </div>

      <div class="form-group">
        <label class="label" for="url">Agent URL</label>
        <input 
          type="url" 
          id="url" 
          name="url" 
          class="input mono" 
          placeholder="https://example.com/agent"
          value="{{ form.url|default('') }}"
          required
        >
        <span class="form-hint">The URL where your agent's A2A endpoint lives</span>
      </div>

      <div class="form-group">
        <label class="label" for="description">Description</label>
        <textarea 
          id="description" 
          name="description" 
          class="input textarea" 
          placeholder="What does your agent do?"
        >{{ form.description|default('') }}</textarea>
      </div>

      <div class="form-group">
        <label class="label" for="card_json">Agent Card JSON <span class="text-tertiary">(optional)</span></label>
        <textarea 
          id="card_json" 
          name="card_json" 
          class="input textarea mono" 
          placeholder='{"protocolVersion": "0.3.0", "skills": [...]}'
          style="min-height: 120px;"
        >{{ form.card_json|default('') }}</textarea>
        <span class="form-hint">Full A2A Agent Card. If omitted, we'll generate a basic one from the fields above.</span>
      </div>

      <button type="submit" class="btn btn-primary" style="margin-top: 0.5rem;">
        Register agent
      </button>

    </form>
  {% endif %}

</div>

<script>
function copyKey() {
  const key = document.getElementById('api-key').textContent;
  navigator.clipboard.writeText(key).then(() => {
    const btn = document.getElementById('copy-btn');
    btn.textContent = '✓ Copied!';
    btn.style.background = 'var(--success)';
    setTimeout(() => {
      btn.textContent = 'Copy API Key';
      btn.style.background = '';
    }, 3000);
  });
}
</script>
{% endblock %}
